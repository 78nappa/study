# 2025年12月3日に公表されたNext.js脆弱性について

## 概要

React Server Components（RSC）の通信プロトコルにおいて、認証不要でリモートコード実行が可能となるもの。  
CVE-2025-55182（React）およびCVE-2025-66478（Next.js）として識別。

## 深刻度

CVSSスコアは最高値の10.0（Critical）

## 脆弱性の詳細

React Server Componentsのデシリアライゼーション（データの復元処理）において、攻撃者が細工したHTTPリクエストを送ることで、サーバー上で任意のコードを実行できる欠陥。

特に深刻なのは
- Next.jsのApp Routerをデフォルト設定で使用している場合に影響を受けること
- 認証チェックの前にデシリアライゼーション処理が行われるケースがあったため、認証なしで攻撃が可能だったこと

## 影響範囲

Next.js 15系、16系のApp Routerアプリケーションが影響を受ける。ただし、Next.js 13系、14系、Pages Routerアプリケーションは影響を受けない。

## 対策

修正済みバージョンへのアップデートが必要。  

15系の修正済みバージョン

- 15.0.5以上
- 15.1.9以上
- 15.2.6以上
- 15.3.6以上
- 15.4.8以上
- 15.5.7以上

Vercelなどのホスティングサービスでは、プラットフォーム側でもWAFルールなどの対策が実施されている。

---

# 用語解説

## React
Webサイトの見た目（UI）を作るためのJavaScriptライブラリ

## React Server Components（RSC）
サーバーが画面を組み立ててその完成した画面データをユーザーのブラウザへ送る仕組み。  
従来のサーバーがユーザーのブラウザにReactコードを送りブラウザがコードを実行して画面を組み立てる仕組みよりも処理が高速。

## CVE-2025-55182（React）
React Server Componentsに見つかった脆弱性の識別番号

## CVE-2025-66478（Next.js）
Next.jsに割り当てられた脆弱性の識別番号  
Reactとの依存関係による影響

## CVSSスコア
Common Vulnerability Scoring System（共通脆弱性評価システム）の略  
脆弱性の深刻度を0.0～10.0の数値で評価する国際標準

## Next.jsのApp Router

### Routerとは
Webサイトで「どのURLにアクセスしたら、どのページを表示するか」を決める仕組み  

### Next.jsの2つのルーター

#### Pages Router（古い方式）
基本はブラウザで動く仕組み
```
pages/
  ├─ index.js        → トップページ（/）
  ├─ about.js        → 会社概要（/about）
  └─ contact.js      → お問い合わせ（/contact）
```

#### App Router（新しい方式）
デフォルトでサーバーで動く＝React Server Components（RSC）を標準でサポート
```
app/
  ├─ page.js         → トップページ（/）
  ├─ about/
  │   └─ page.js     → 会社概要（/about）
  └─ contact/
      └─ page.js     → お問い合わせ（/contact）
```

## WAFルール
- WAF（Web Application Firewall）で適用される防御ルールのこと
- Webアプリケーションへの攻撃を検知・ブロックする
- 不正なHTTPリクエストや異常なペイロードを遮断
- VercelやCloudflareなどのプラットフォームが、この脆弱性に対するWAFルールを追加して対策を実施
- アプリケーション本体の修正前でも、一定の防御が可能

---

# サプライチェーン攻撃との関連性

今回の脆弱性は**サプライチェーン攻撃ではない**が、サプライチェーンの**脆弱性リスク**を示す事例。

## サプライチェーン攻撃との違い

### サプライチェーン攻撃とは
- 攻撃者がライブラリやパッケージに**意図的に悪意あるコードを混入**させる攻撃
- 例：npmパッケージの乗っ取り、依存パッケージへのマルウェア注入
- 開発者やメンテナーのアカウントが侵害されて起こることが多い

### 今回のケース
- React/Next.jsのコードに存在していた**セキュリティ上の欠陥（バグ）**
- 悪意を持って混入されたものではなく、開発過程で生じた設計・実装ミス
- 発見後、公式チームが迅速に修正版をリリース

## サプライチェーンとの関連性

### 依存関係による影響拡大
- Next.jsはReactに依存している
- **Reactの脆弱性が、それを使用する全てのNext.jsアプリケーションに波及**
- 一つのライブラリの問題が、依存する多数のプロジェクトに影響

### 広範な影響範囲
- Reactは世界中の開発者の40%以上が使用
- Next.jsも約20%の開発者が利用
- **一つの脆弱性が膨大な数のアプリケーションに影響**

### 自動的な依存関係の取り込み
- 多くのプロジェクトがnpmやyarnで依存パッケージを自動管理
- 脆弱なバージョンが知らないうちに含まれている可能性
- **開発者が意識していない依存関係にも脆弱性が潜む**

## 教訓：サプライチェーンセキュリティの重要性

今回の件から学べること：

### 1. 依存パッケージの監視が必要
- Dependabot、Renovateなどの自動更新ツールの活用
- 定期的な脆弱性スキャン
- package.jsonやpackage-lock.jsonの定期的な見直し

### 2. 迅速なアップデート体制
- 脆弱性が公表されたら速やかに対応
- Vercelのような警告システムの活用
- セキュリティパッチの優先的な適用

### 3. 多層防御の構築
- WAFなどのプラットフォーム側の防御
- アプリケーションレベルのセキュリティ対策
- ランタイム保護やファイアウォールルールの設定

### 4. サプライチェーン全体の把握
- 使用しているライブラリとそのバージョンの管理
- 依存関係ツリーの可視化
- 直接・間接的な依存関係の両方を理解

## まとめ

今回は悪意ある攻撃ではないが、**依存するライブラリの脆弱性が自分のアプリケーションに直接影響する**という点で、サプライチェーンセキュリティの重要性を示す良い例。

サプライチェーン攻撃と脆弱性は異なるものだが、どちらも依存関係を通じてアプリケーションに影響を及ぼすため、同様の対策と警戒が必要。

---

# ライブラリとパッケージについて

## ライブラリ（Library）とは

### 基本的な概念
- **再利用可能なコードの集まり**
- 特定の機能を提供するプログラムの部品
- 開発者が一から書く必要がない、便利な機能をまとめたもの

### 具体例
- **React**: UIを構築するためのライブラリ
- **Lodash**: 配列やオブジェクト操作を簡単にするライブラリ
- **Axios**: HTTP通信を行うライブラリ
- **jQuery**: DOM操作を簡単にするライブラリ

### 利用例
```javascript
// Reactライブラリを使ってボタンを作成
import React from 'react';

function MyButton() {
  return <button>クリック</button>;
}
```

自分でボタンの表示ロジックを全て書く代わりに、Reactライブラリの機能を使って簡単に実装することができる。

## パッケージ（Package）とは

### 基本的な概念
- **配布・管理しやすい形にまとめられたライブラリ**
- ライブラリを含む、配布用の「箱」のようなもの
- バージョン情報、依存関係、メタデータなどを含む

### 構成要素
- ライブラリのコード本体
- `package.json`（パッケージの情報を記載したファイル）
- 依存する他のパッケージの情報
- ドキュメント、ライセンス情報など

### 具体例
```json
// package.jsonの例
{
  "name": "react",
  "version": "18.2.0",
  "description": "React is a JavaScript library for building user interfaces.",
  "dependencies": {
    "loose-envify": "^1.1.0"
  }
}
```

## ライブラリとパッケージの関係

### 簡単に言うと
- **ライブラリ** = 機能を提供するコード
- **パッケージ** = そのライブラリを配布・管理するための形式

### 比喩的な説明
- **ライブラリ** = 本の内容（知識や情報）
- **パッケージ** = 本そのもの（表紙、目次、ページ番号などを含む完成品）

### 実際の使用場面
```bash
# npmでパッケージをインストール
npm install react

# このコマンドで「react」というパッケージがダウンロードされ
# その中に含まれるReactライブラリが使えるようになる
```

## パッケージマネージャー

### 主なパッケージマネージャー
- **npm**: Node.jsのデフォルトのパッケージマネージャー
- **yarn**: Facebookが開発した高速なパッケージマネージャー
- **pnpm**: ディスク容量を節約できるパッケージマネージャー

### 役割
- パッケージのインストール
- バージョン管理
- 依存関係の解決
- パッケージの更新・削除

## Next.jsプロジェクトでの例

### package.jsonの例
```json
{
  "name": "my-nextjs-app",
  "version": "1.0.0",
  "dependencies": {
    "next": "15.5.7",      // Next.jsパッケージ
    "react": "19.0.1",      // Reactパッケージ
    "react-dom": "19.0.1"   // React DOMパッケージ
  }
}
```

### 依存関係のイメージ
```
プロジェクト
 ├─ Next.jsパッケージ（Next.jsライブラリを含む）
 │   └─ Reactパッケージに依存
 ├─ Reactパッケージ（Reactライブラリを含む）
 └─ React DOMパッケージ（React DOMライブラリを含む）
```

## なぜライブラリ・パッケージを使うのか

### メリット

#### 1. 開発効率の向上
- 一から実装する必要がない
- 検証済みのコードを使える

#### 2. 品質の向上
- 多くの開発者によってテスト・改善されている
- バグが少ない

#### 3. 保守性の向上
- コミュニティによるサポート
- 定期的なアップデート

#### 4. 標準化
- 多くのプロジェクトで同じツールを使用
- 情報共有が容易

### デメリット・リスク

#### 1. 依存関係の複雑化
- 多くのパッケージに依存すると管理が困難

#### 2. 脆弱性リスク
- 今回のNext.js/Reactの事例のように、使用しているパッケージに脆弱性が見つかることがある

#### 3. サイズの増加
- 多くのパッケージを入れるとアプリケーションが大きくなる

#### 4. バージョン互換性
- パッケージ同士の互換性問題が発生することがある

## 今回の脆弱性との関連

### 依存関係による影響の連鎖
```
Reactパッケージに脆弱性
    ↓
Next.jsはReactに依存
    ↓
Next.jsに依存しているプロジェクトも影響を受ける
```

### 重要なポイント
- 直接使っていないライブラリ（間接的な依存関係）にも注意が必要
- パッケージマネージャーが自動的に依存パッケージをインストールするため、知らないうちに脆弱性を含むことがある
- 定期的なアップデートと脆弱性チェックが重要

## まとめ

- **ライブラリ**：便利な機能を提供するコードの集まり
- **パッケージ**：ライブラリを配布・管理しやすい形にまとめたもの
- 実際の開発では、npmなどのパッケージマネージャーを使ってパッケージをインストールし、その中のライブラリを利用する
- 便利である一方、脆弱性リスクなどもあるため、適切な管理が必要
- 今回のような脆弱性は、依存関係を通じて連鎖的に影響するため、サプライチェーン全体の理解と管理が重要