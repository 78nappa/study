# Next.js脆弱性について

## 脆弱性の概要

2025年12月3日に公表されたこの脆弱性は、React Server Components（RSC）の通信プロトコルにおいて、認証不要でリモートコード実行が可能となる重大なものです。CVE-2025-55182（React）およびCVE-2025-66478（Next.js）として識別されています。

## 深刻度

CVSSスコアは最高値の10.0（Critical）と評価されており、極めて深刻な脆弱性です。

## 何が問題だったのか

React Server Componentsのデシリアライゼーション（データの復元処理）において、攻撃者が細工したHTTPリクエストを送ることで、サーバー上で任意のコードを実行できる欠陥がありました。

特に深刻なのは:
- Next.jsのApp Routerをデフォルト設定で使用している場合に影響を受けること
- 認証チェックの前にデシリアライゼーション処理が行われるケースがあったため、認証なしで攻撃が可能だったこと

## 影響範囲

Next.js 15系、16系のApp Routerアプリケーションが影響を受けます。ただし、Next.js 13系、14系、Pages Routerアプリケーションは影響を受けません。

## 対策バージョン

修正済みバージョンへのアップデートが必要です。15系の修正済みバージョンは以下の通りです：

- 15.0.5以上
- 15.1.9以上
- 15.2.6以上
- 15.3.6以上
- 15.4.8以上
- 15.5.7以上

Vercelなどのホスティングサービスでは、プラットフォーム側でもWAFルールなどの対策が実施されています。

---

# 用語解説

## React Server Components（RSC）
- React 18で導入された新しいアーキテクチャ
- サーバー側でReactコンポーネントをレンダリングする機能
- クライアントに送るJavaScriptの量を削減し、パフォーマンスを向上させる
- Next.jsのApp Routerで標準的に使用されている
- 今回の脆弱性はこのRSCの通信プロトコルに存在していた

## CVE-2025-55182（React）
- React本体のReact Server Componentsに見つかった脆弱性の識別番号
- 2025年11月29日に発見され、12月3日に公表された
- デシリアライゼーション（データ復元処理）の欠陥が原因
- 認証なしでサーバー上で任意のコードを実行できる重大な問題
- Reactの根本的な部分に存在していたため影響範囲が広い

## CVE-2025-66478（Next.js）
- Next.jsに割り当てられた脆弱性の識別番号
- 内容としてはCVE-2025-55182と同等で、重複としてReject扱いとされている
- Next.jsはReactに依存しているため、React側の脆弱性の影響を受けた
- Next.js固有の問題ではなく、依存関係による影響

## CVSSスコア
- Common Vulnerability Scoring System（共通脆弱性評価システム）の略
- 脆弱性の深刻度を0.0～10.0の数値で評価する国際標準
- 今回は最高値の10.0が付けられた（Critical：緊急）
- 攻撃の容易さ、影響範囲、必要な権限などを総合的に評価
- 10.0は極めて深刻で、認証不要・容易に攻撃可能な場合に付けられる

## Next.jsのApp Router
- Next.js 13以降で導入された新しいルーティングシステム
- 従来のPages Routerに代わる次世代のアーキテクチャ
- React Server Componentsを標準でサポート
- `app/`ディレクトリを使用する構成
- 今回の脆弱性はApp Routerを使用している環境が影響を受けた（Pages Routerは影響なし）

## WAFルール
- WAF（Web Application Firewall）で適用される防御ルールのこと
- Webアプリケーションへの攻撃を検知・ブロックする
- 不正なHTTPリクエストや異常なペイロードを遮断
- VercelやCloudflareなどのプラットフォームが、この脆弱性に対するWAFルールを追加して対策を実施
- アプリケーション本体の修正前でも、一定の防御が可能